{% extends "base.html" %}
{% block title %}Investigación OSINT{% endblock %}

{% block content %}
<h2 class="mb-4">Investigación OSINT</h2>

<form id="investigation-form" method="post" class="card p-4 shadow-sm mb-4">
    {% csrf_token %}
    {{ form.as_p }}
    <button type="submit" class="btn btn-primary">Investigar</button>
</form>

<div id="loading" style="display:none;">
    <div class="spinner-border text-primary" role="status">
        <span class="visually-hidden">Cargando...</span>
    </div>
    <p>Realizando búsqueda...</p>
</div>

<div id="results-container"></div>

<script>
document.getElementById("investigation-form").addEventListener("submit", function(event) {
    event.preventDefault();
    let form = event.target;
    let formData = new FormData(form);

    document.getElementById("loading").style.display = "block";
    document.getElementById("results-container").innerHTML = "";

    fetch("{% url 'sherlock_search' %}", {
        method: "POST",
        headers: {
            "X-CSRFToken": formData.get("csrfmiddlewaretoken")
        },
        body: formData
    }).then(response => response.text())
      .then(html => {
        document.getElementById("loading").style.display = "none";
        document.getElementById("results-container").innerHTML = html;
      });
});
</script>
{% endblock %}